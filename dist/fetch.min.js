/**
 * @module fetch
 * @author nuintun
 * @license MIT
 * @version 0.0.1
 * @description A pure JavaScript window.fetch polyfill.
 * @see https://nuintun.github.io/fetch
 */
!function(){"use strict";if(!window.fetch){var e="FormData"in window,t="ArrayBuffer"in window,r="URLSearchParams"in window,o="FileReader"in window&&"Blob"in window,n="Symbol"in window&&"iterator"in Symbol,i="XDomainRequest"in window&&document.documentMode>>0<10,s=Object.prototype.toString,a=Object.create,h=Object.setPrototypeOf,u=/^([a-z0-9.+-]+:)?\/\/([^/:]*)(?::([^/]*))?@/i,d=document.createElement("a"),c=location.port||{"http:":"80","https:":"443"}[location.protocol];if(x.prototype.append=function(e,t){g("Headers","append",2,arguments.length);var r=T(e);this["<names>"][r]=e;var o=this["<headers>"][r];t=E(t),this["<headers>"][r]=o?o+","+t:t},x.prototype["delete"]=function(e){g("Headers","delete",1,arguments.length),e=T(e),delete this["<headers>"][e],delete this["<names>"][e]},x.prototype.get=function(e){return g("Headers","get",1,arguments.length),e=T(e),this.has(e)?this["<headers>"][e]:null},x.prototype.has=function(e){return g("Headers","has",1,arguments.length),this["<headers>"].hasOwnProperty(T(e))},x.prototype.set=function(e,t){g("Headers","set",2,arguments.length);var r=T(e);this["<names>"][r]=e,this["<headers>"][r]=E(t)},x.prototype.forEach=function(e,t){g("Headers","forEach",1,arguments.length);var r=this["<headers>"];for(var o in r)r.hasOwnProperty(o)&&e.call(t,r[o],o,this)},x.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),R(e)},x.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),R(e)},x.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),R(e)},n&&(x.prototype[Symbol.iterator]=x.prototype.entries),window.Headers=x,t)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=function(e){return e&&DataView.prototype.isPrototypeOf(e)},p=ArrayBuffer.isView||function(e){return e&&f.indexOf(s.call(e))>-1};S.prototype["<body>"]=function(n){this.body=n;var i=!this.headers.has("Content-Type");"string"===b(n)?(this["<text>"]=n,i&&this.headers.set("Content-Type","text/plain;charset=UTF-8")):o&&Blob.prototype.isPrototypeOf(n)?(this["<blob>"]=n,i&&this["<blob>"].type&&this.headers.set("Content-Type",this["<blob>"].type)):e&&FormData.prototype.isPrototypeOf(n)?this["<formData>"]=n:r&&URLSearchParams.prototype.isPrototypeOf(n)?(this["<text>"]=n.toString(),i&&this.headers.set("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")):t&&o&&l(n)?(this["<arrayBuffer>"]=B(n.buffer),this.body=new Blob([this["<arrayBuffer>"]])):t&&(ArrayBuffer.prototype.isPrototypeOf(n)||p(n))?this["<arrayBuffer>"]=B(n):(this.body=null,this["<text>"]="")},o&&(S.prototype.blob=function(){if(A(this),this["<blob>"])return Promise.resolve(this["<blob>"]);if(this["<arrayBuffer>"])return Promise.resolve(new Blob([this["<arrayBuffer>"]]));if(this["<formData>"])throw new Error("Could not read FormData body as blob");return Promise.resolve(new Blob([this["<text>"]]))},S.prototype.arrayBuffer=function(){return this["<arrayBuffer>"]?(A(this),Promise.resolve(this["<arrayBuffer>"])):this.blob().then(U)}),S.prototype.text=function(){if(A(this),this["<blob>"])return e=this["<blob>"],t=new FileReader,r=P(t),t.readAsText(e),r;if(this["<arrayBuffer>"])return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),o=0;o<t.length;o++)r[o]=String.fromCharCode(t[o]);return r.join("")}(this["<arrayBuffer>"]));if(this["<formData>"])throw new Error("Could not read FormData body as text");return Promise.resolve(this["<text>"]);var e,t,r},e&&(S.prototype.formData=function(){return this.text().then(O)}),S.prototype.json=function(){return this.text().then(JSON.parse)};var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];v(S,j),j.prototype.clone=function(){return new j(this,{body:this.body})},window.Request=j;var w=[301,302,303,307,308];v(S,q),q.prototype.url="",q.prototype.type="default",q.prototype.redirected=!1,q.prototype.clone=function(){return new q(this.body,{status:this.status,statusText:this.statusText,headers:new x(this.headers),url:this.url})},q.error=function(){var e=new q(null,{status:0,statusText:""});return e.type="error",e},q.redirect=function(e,t){if(g("Response","redirect",1,arguments),-1===w.indexOf(t))throw new RangeError("Invalid redirect status code");return new q(null,{status:t,headers:{location:e}})},window.Response=q,window.fetch=function(e,t){return g("Window","fetch",1,arguments.length),new Promise(function(r,n){var s,a=function(e){if(d.href=e,!d.host)return!1;var t=d.protocol;if(t&&t!==location.protocol)return!0;var r=d.port;return!(!r||r===c)||d.hostname!==location.hostname}((s=!t&&t instanceof j?e:new j(e,t)).url);if(a)switch(s.mode){case"same-origin":return n(new TypeError('Request mode is "same-origin" but the URL\'s origin is not same as the request origin'));case"no-cors":var h=new q;return h.ok=!1,h.status=0,h.statusText="",h.type="opaque",r(h)}var u=a&&i?new XDomainRequest:new XMLHttpRequest,f="onload"in u;function l(e){f?e.onload=null:e.onreadystatechange=null,e.onerror=null,e.ontimeout=null,e.onabort=null}function p(e){n(new TypeError("Request "+s.url+" "+e))}function y(){l(u);var e,t,o,n,i=(e=u,t=new x,e.getAllResponseHeaders&&(e.getAllResponseHeaders()||"").replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),o=r.shift().trim();if(o){var n=r.join(":").trim();t.append(o,n)}}),t),h="response"in u?u.response:u.responseText,d={headers:i,status:u.status||200,statusText:u.statusText};try{var c=new q(h,d)}catch(f){return p(f)}c.type=a?"cors":"basic",c.url=(n=i,("responseURL"in(o=u)?o.responseURL:n.get("X-Request-URL"))||s.url.replace(/#.*/,"")),r(c)}f?u.onload=y:u.onreadystatechange=function(){4===u.readyState&&y()},u.onerror=function(){l(u),p("failed")},u.ontimeout=function(){l(u),p("timeout")},u.onabort=function(){l(u),p("aborted")};try{if(u.open(s.method,s.url,!0),u.timeout=Math.max(s.timeout>>0,0),u.responseType=o?"blob":"text","include"===s.credentials?u.withCredentials=!0:"omit"===s.credentials&&(u.withCredentials=!1),u.setRequestHeader){var w=s.headers;w.forEach(function(e,t){u.setRequestHeader(this._headerNames[t],e)},w)}u.send(s.body===undefined?null:s.body)}catch(b){l(u),n(b)}})}}function b(e){return null===e||e===undefined?String(e):s.call(e).replace(/\[object (\w+)\]/,"$1").toLowerCase()}function m(){}function v(e,t){var r=e.prototype;h?h(t.prototype,r):a?t.prototype=a(r):(m.prototype=r,t.prototype=new m),t.prototype.constructor=t}function g(e,t,r,o){if(o<r)throw new TypeError("Failed to execute '"+t+"' on '"+e+"': "+r+" arguments required, but only "+o+" present")}function T(e){if(!(e=String(e))||/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid header name");return e.toLowerCase()}function E(e){return e=String(e)}function R(e){var t=0,r=e.length,o={next:function(){var o=t>=r;return{done:o,value:o?undefined:e[t++]}}};return n&&(o[Symbol.iterator]=function(){return o}),o}function x(e){if(this["<names>"]={},this["<headers>"]={},e===undefined)return this;if(e instanceof x)e.forEach(function(e,t){this.append(t,e)},this);else if(Array.isArray(e))e.forEach(function(e){if(e.length<2)throw new TypeError("Invalid header value");var t=e[0],r=e[1];this.append(t,r)},this);else{if("object"!==b(e))throw new TypeError("The headers provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");for(var t in e)e.hasOwnProperty(t)&&this.append(t,e[t])}}function A(e){if(e.bodyUsed)throw new TypeError("Already read");e.bodyUsed=!0}function P(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function U(e){var t=new FileReader,r=P(t);return t.readAsArrayBuffer(e),r}function B(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function O(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(n))}}),t}function S(){this.bodyUsed=!1}function j(e,t){var r=arguments.length;if(r<1)throw new TypeError("Request construct need 1 argument required, but only "+r+" present");S.call(this);var o,n,i,s,a=(t=t||{}).body;if(e instanceof j){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.mode=e.mode,this.method=e.method,this.credentials=e.credentials,this.redirect=e.redirect,this.referrer=e.referrer,this.referrerPolicy=e.referrerPolicy,t.headers||(this.headers=new x(e.headers)),a||null===e.body||(a=e.body,e.bodyUsed=!0)}else{var h=String(e);if(s=h,u.test(s))throw new TypeError("Request cannot be constructed from a URL that includes credentials: "+h);if(this.url=(i=h,d.href=i,d.host||(d.host=location.host),d.href),this.mode=function(e){switch(e){case"no-cors":case"navigate":case"same-origin":return e;default:return"cors"}}(t.mode),this.method=t.hasOwnProperty("method")?(o=t.method,n=(o=String(o)).toUpperCase(),y.indexOf(n)>-1?n:o):"GET",("GET"===this.method||"HEAD"===this.method)&&a)throw new TypeError("Request with GET/HEAD method cannot have body");this.credentials=t.credentials||"omit",this.redirect=t.redirect||"follow",this.referrer=t.referrer||"about:client",this.referrerPolicy=t.referrerPolicy||"",this.headers=new x(t.headers||{})}this["<body>"](a)}function q(e,t){S.call(this);var r=(t=t||{}).hasOwnProperty("status")?t.status>>0:200;if(1223===r&&(r=204),r<200||r>599)throw new TypeError("The response status provided ("+r+") is outside the range [200, 599]");this.status=r,this.ok=r>=200&&r<300,this.headers=new x(t.headers),this.statusText=t.statusText||(200===r?"OK":""),this["<body>"](e)}}();
//# sourceMappingURL=fetch.js.map