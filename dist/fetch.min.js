/**
* @module fetch
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript window.fetch polyfill.
* @see https://nuintun.github.io/fetch
*/
!function(){"use strict";function e(e){return null===e||e===undefined?String(e):A.call(e).replace(/\[object (\w+)\]/,"$1").toLowerCase()}function t(){}function r(e,r){var o=e.prototype;_?_(r.prototype,o):E?r.prototype=E(o):(t.prototype=o,r.prototype=new t),r.prototype.constructor=r}function o(e,t,r,o){if(o<r)throw new TypeError("Failed to execute '"+t+"' on '"+e+"': "+r+" arguments required, but only "+o+" present")}function n(e){if(!(e=String(e))||/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid header name");return e.toLowerCase()}function i(e){return e=String(e)}function s(e){var t=0,r=e.length,o={next:function(){var o=t>=r;return{done:o,value:o?undefined:e[t++]}}};return g&&(o[Symbol.iterator]=function(){return o}),o}function a(t){if(this.map={},this._headerNames={},t===undefined)return this;if(t instanceof a)t.forEach(function(e,t){this.append(t,e)},this);else if(Array.isArray(t))t.forEach(function(e){if(e.length<2)throw new TypeError("Invalid header value");var t=e[0],r=e[1];this.append(t,r)},this);else{if("object"!==e(t))throw new TypeError("The headers provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");for(var r in t)t.hasOwnProperty(r)&&this.append(r,t[r])}}function u(e){if(e.bodyUsed)throw new TypeError("Already read");e.bodyUsed=!0}function h(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function d(e){var t=new FileReader,r=h(t);return t.readAsArrayBuffer(e),r}function c(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(n))}}),t}function p(){this.bodyUsed=!1}function l(e,t){var r=arguments.length;if(r<1)throw new TypeError("Request construct need 1 argument required, but only "+r+" present");p.call(this);var o=(t=t||{}).body;if(e instanceof l){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.mode=e.mode,this.method=e.method,this.credentials=e.credentials,this.redirect=e.redirect,this.referrer=e.referrer,this.referrerPolicy=e.referrerPolicy,t.headers||(this.headers=new a(e.headers)),o||null===e.body||(o=e.body,e.bodyUsed=!0)}else{var n=String(e);if(function(e){return B.test(e)}(n))throw new TypeError("Request cannot be constructed from a URL that includes credentials: "+n);if(this.url=function(e,t){return R.href=e,R.host||(R.host=location.host),R.href}(n),this.mode=function(e){switch(e){case"no-cors":case"navigate":case"same-origin":return e;default:return"cors"}}(t.mode),this.method=t.hasOwnProperty("method")?function(e){var t=(e=String(e)).toUpperCase();return S.indexOf(t)>-1?t:e}(t.method):"GET",("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Request with GET/HEAD method cannot have body");this.credentials=t.credentials||"omit",this.redirect=t.redirect||"follow",this.referrer=t.referrer||"about:client",this.referrerPolicy=t.referrerPolicy||"",this.headers=new a(t.headers||{})}this._initBody(o)}function y(e,t){p.call(this);var r=(t=t||{}).hasOwnProperty("status")?t.status>>0:200;if(1223===r&&(r=204),r<200||r>599)throw new TypeError("The response status provided ("+r+") is outside the range [200, 599]");this.status=r,this.ok=r>=200&&r<300,this.headers=new a(t.headers),this.statusText=t.statusText||(200===r?"OK":""),this._initBody(e)}if(!window.fetch){var w="FormData"in window,b="ArrayBuffer"in window,m="URLSearchParams"in window,v="FileReader"in window&&"Blob"in window,g="Symbol"in window&&"iterator"in Symbol,T="XDomainRequest"in window&&document.documentMode>>0<10,A=Object.prototype.toString,E=Object.create,_=Object.setPrototypeOf,B=/^([a-z0-9.+-]+:)?\/\/([^/:]*)(?::([^/]*))?@/i,R=document.createElement("a"),x=location.port||{"http:":"80","https:":"443"}[location.protocol];if(a.prototype.append=function(e,t){o("Headers","append",2,arguments.length);var r=n(e);this._headerNames[r]=e;var s=this.map[r];t=i(t),this.map[r]=s?s+","+t:t},a.prototype["delete"]=function(e){o("Headers","delete",1,arguments.length),e=n(e),delete this.map[e],delete this._headerNames[e]},a.prototype.get=function(e){return o("Headers","get",1,arguments.length),e=n(e),this.has(e)?this.map[e]:null},a.prototype.has=function(e){return o("Headers","has",1,arguments.length),this.map.hasOwnProperty(n(e))},a.prototype.set=function(e,t){o("Headers","set",2,arguments.length);var r=n(e);this._headerNames[r]=e,this.map[r]=i(t)},a.prototype.forEach=function(e,t){o("Headers","forEach",1,arguments.length);for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},a.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),s(e)},a.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),s(e)},a.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),s(e)},g&&(a.prototype[Symbol.iterator]=a.prototype.entries),window.Headers=a,b)var P=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],U=function(e){return e&&DataView.prototype.isPrototypeOf(e)},O=ArrayBuffer.isView||function(e){return e&&P.indexOf(A.call(e))>-1};p.prototype._initBody=function(t){this.body=t;var r=!this.headers.has("Content-Type");"string"===e(t)?(this._bodyText=t,r&&this.headers.set("Content-Type","text/plain;charset=UTF-8")):v&&Blob.prototype.isPrototypeOf(t)?(this._bodyBlob=t,r&&this._bodyBlob.type&&this.headers.set("Content-Type",this._bodyBlob.type)):w&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:m&&URLSearchParams.prototype.isPrototypeOf(t)?(this._bodyText=t.toString(),r&&this.headers.set("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")):b&&v&&U(t)?(this._bodyArrayBuffer=c(t.buffer),this.body=new Blob([this._bodyArrayBuffer])):b&&(ArrayBuffer.prototype.isPrototypeOf(t)||O(t))?this._bodyArrayBuffer=c(t):(this.body=null,this._bodyText="")},v&&(p.prototype.blob=function(){if(u(this),this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("Could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},p.prototype.arrayBuffer=function(){return this._bodyArrayBuffer?(u(this),Promise.resolve(this._bodyArrayBuffer)):this.blob().then(d)}),p.prototype.text=function(){if(u(this),this._bodyBlob)return function(e){var t=new FileReader,r=h(t);return t.readAsText(e),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),o=0;o<t.length;o++)r[o]=String.fromCharCode(t[o]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("Could not read FormData body as text");return Promise.resolve(this._bodyText)},w&&(p.prototype.formData=function(){return this.text().then(f)}),p.prototype.json=function(){return this.text().then(JSON.parse)};var S=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];r(p,l),l.prototype.clone=function(){return new l(this,{body:this.body})},window.Request=l;var j=[301,302,303,307,308];r(p,y),y.prototype.url="",y.prototype.type="default",y.prototype.redirected=!1,y.prototype.clone=function(){return new y(this.body,{status:this.status,statusText:this.statusText,headers:new a(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e},y.redirect=function(e,t){if(o("Response","redirect",1,arguments),-1===j.indexOf(t))throw new RangeError("Invalid redirect status code");return new y(null,{status:t,headers:{location:e}})},window.Response=y,window.fetch=function(e,t){return o("Window","fetch",1,arguments.length),new Promise(function(r,o){function n(e){f?e.onload=null:e.onreadystatechange=null,e.onerror=null,e.ontimeout=null,e.onabort=null}function i(e){o(new TypeError("Request "+u.url+" "+e))}function s(){n(c);var e=function(e){var t=new a;return e.getAllResponseHeaders&&(e.getAllResponseHeaders()||"").replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),o=r.shift().trim();if(o){var n=r.join(":").trim();t.append(o,n)}}),t}(c),t="response"in c?c.response:c.responseText,o={headers:e,status:c.status||200,statusText:c.statusText};try{var s=new y(t,o)}catch(d){return i(d)}s.type=h?"cors":"basic",s.url=function(e,t,r){return"responseURL"in e?e.responseURL:t.get("X-Request-URL")}(c,e)||u.url.replace(/#.*/,""),r(s)}var u,h=function(e){if(R.href=e,!R.host)return!1;var t=R.protocol;if(t&&t!==location.protocol)return!0;var r=R.port;return!(!r||r===x)||R.hostname!==location.hostname}((u=!t&&t instanceof l?e:new l(e,t)).url);if(h)switch(u.mode){case"same-origin":return o(new TypeError('Request mode is "same-origin" but the URL\'s origin is not same as the request origin'));case"no-cors":var d=new y;return d.ok=!1,d.status=0,d.statusText="",d.type="opaque",r(d)}var c=function(e){return e&&T?new XDomainRequest:new XMLHttpRequest}(h),f="onload"in c;f?c.onload=s:c.onreadystatechange=function(){4===c.readyState&&s()},c.onerror=function(){n(c),i("failed")},c.ontimeout=function(){n(c),i("timeout")},c.onabort=function(){n(c),i("aborted")};try{if(c.open(u.method,u.url,!0),c.timeout=Math.max(u.timeout>>0,0),c.responseType=v?"blob":"text","include"===u.credentials?c.withCredentials=!0:"omit"===u.credentials&&(c.withCredentials=!1),c.setRequestHeader){var p=u.headers;p.forEach(function(e,t){c.setRequestHeader(this._headerNames[t],e)},p)}c.send(u.body===undefined?null:u.body)}catch(w){n(c),o(w)}})}}}();
//# sourceMappingURL=fetch.js.map